<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Reader</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --border: 240 5.9% 90%;
            --radius: 0.5rem;
            /* Responsive card sizes */
            --deck-card-width: clamp(40px, 5vw, 60px);
            --deck-card-height: calc(var(--deck-card-width) * 1.6);
            --placed-card-width: clamp(100px, 12vw, 150px);
            --placed-card-height: calc(var(--placed-card-width) * 1.6);
            --card-overlap: clamp(6px, 0.8vw, 10px);
        }
        .dark {
            --background: 240 10% 3.9%;
            --foreground: 0 0% 98%;
            --card: 240 10% 3.9%;
            --card-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 240 5.9% 10%;
            --muted: 240 3.7% 15.9%;
            --muted-foreground: 240 5% 64.9%;
            --accent: 240 3.7% 15.9%;
            --border: 240 3.7% 15.9%;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            overflow: hidden;
            transition: background-color 0.2s, color 0.2s;
            user-select: none;
            -webkit-user-select: none;
        }
        .app-container { display: flex; flex-direction: column; height: 100vh; }
        header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid hsl(var(--border));
        }
        h1 { font-weight: 600; font-size: 0.9rem; letter-spacing: -0.01em; }
        .controls { display: flex; gap: 0.5rem; align-items: center; }
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            font-size: 0.8125rem; font-weight: 500; font-family: inherit;
            height: 2rem; padding: 0 0.875rem; border-radius: var(--radius);
            transition: all 0.15s ease; cursor: pointer;
        }
        .btn-default { background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); border: none; }
        .btn-default:hover { opacity: 0.9; }
        .btn-outline { background: transparent; border: 1px solid hsl(var(--border)); color: hsl(var(--foreground)); }
        .btn-outline:hover { background: hsl(var(--accent)); }
        .btn-ghost { background: transparent; border: none; color: hsl(var(--foreground)); padding: 0 0.5rem; }
        .btn-ghost:hover { background: hsl(var(--accent)); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .toggle-group { display: flex; align-items: center; gap: 0.5rem; }
        .toggle-label { font-size: 0.8125rem; color: hsl(var(--muted-foreground)); }
        .toggle {
            position: relative; width: 2.25rem; height: 1.25rem;
            background: hsl(var(--muted)); border-radius: 9999px;
            cursor: pointer; transition: background 0.2s;
        }
        .toggle::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 1rem; height: 1rem; background: white;
            border-radius: 50%; transition: transform 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .toggle.active { background: hsl(var(--primary)); }
        .toggle.active::after { transform: translateX(1rem); }
        main { flex: 1; display: flex; flex-direction: column; padding: 1rem; gap: 0.75rem; overflow: hidden; }
        .reading-surface {
            flex: 1; background: hsl(var(--muted) / 0.3);
            border: 1px dashed hsl(var(--border)); border-radius: var(--radius);
            position: relative; overflow: hidden;
        }
        .deck-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }
        .reading-surface::before {
            content: 'Drag cards here'; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 0.875rem;
            color: hsl(var(--muted-foreground) / 0.6); pointer-events: none;
        }
        .placed-card { 
            position: absolute; cursor: pointer; 
            width: var(--placed-card-width) !important; 
            height: var(--placed-card-height) !important;
            animation: cardGrow 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            transition: transform 0.3s ease;
            transform-style: preserve-3d;
        }
        @keyframes cardGrow {
            from { transform: scale(0.5); opacity: 0.5; }
            to { transform: scale(1); opacity: 1; }
        }
        .placed-card:hover:not(.flipped) { transform: scale(1.02); z-index: 100; }
        .placed-card.flipped { transform: rotateY(180deg) !important; animation: none; }
        .placed-card.flipped.reversed { transform: rotateY(180deg) rotate(180deg) !important; }
        .placed-card .card-face { border-radius: var(--radius); }
        .placed-card .card-placeholder .card-number { font-size: 2rem; font-weight: 600; }
        .placed-card .card-placeholder .card-suit { font-size: 0.875rem; }
        .modal-card.reversed { transform: rotate(180deg); }
        .keywords-upright.active .keywords-label { font-weight: 700; }
        .keywords-reversed.active .keywords-label { font-weight: 700; }
        .keywords-upright:not(.active), .keywords-reversed:not(.active) { opacity: 0.5; }
        .deck-area {
            height: clamp(100px, 15vh, 160px); display: flex; align-items: center; justify-content: center;
            position: relative; padding: 1.5rem 1rem 1rem;
            background: hsl(var(--muted) / 0.2); border-radius: var(--radius);
            overflow: visible;
        }
        @media (max-width: 600px) {
            .deck-area { height: clamp(180px, 28vh, 240px); padding-top: 1.75rem; }
        }
        .deck-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .card {
            width: var(--deck-card-width); height: var(--deck-card-height); position: absolute; cursor: grab;
            transform-style: preserve-3d; transition: transform 0.3s ease;
        }
        .card:active { cursor: grabbing; }
        .deck-container .card {
            transition: transform 0.15s ease-out;
        }
        .deck-container:not(.dragging-active) .card:hover:not(.dragging) {
            transform: translate(-50%, calc(-50% - 15px)) translateX(var(--base-x, 0px)) translateY(var(--base-y, 0px)) rotate(var(--base-rot, 0deg)) scale(1.05) !important;
        }
        .card.dragging {
            transition: none !important;
        }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
            border-radius: calc(var(--radius) - 2px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
        }
        .card-back {
            background: url('https://steve-p.org/cards/small/sm_RWSa-X-RL.webp') center/cover;
            display: flex;
            align-items: center; justify-content: center;
            border: 1px solid hsl(var(--border));
            z-index: 2;
        }
        .card-back::before {
            display: none;
        }
        .card-front {
            background: hsl(var(--card)); transform: rotateY(180deg);
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; padding: 0.25rem; overflow: hidden;
            border: 1px solid hsl(var(--border));
        }
        .card-front img { width: 100%; height: 100%; object-fit: cover; border-radius: 2px; }
        .card-placeholder {
            width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; gap: 0.125rem;
        }
        .card-placeholder .card-number { font-size: 1rem; font-weight: 600; color: hsl(var(--foreground)); }
        .card-placeholder .card-suit { font-size: 0.625rem; color: hsl(var(--muted-foreground)); text-transform: uppercase; letter-spacing: 0.02em; }
        .card.flipped { transform: rotateY(180deg); }
        .dev-label {
            position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%);
            font-size: 0.5rem; font-family: ui-monospace, monospace;
            color: hsl(var(--muted-foreground)); white-space: nowrap;
            background: hsl(var(--background)); padding: 1px 3px; border-radius: 2px;
            opacity: 0; transition: opacity 0.15s ease; border: 1px solid hsl(var(--border));
        }
        body.dev-mode .dev-label { opacity: 1; }
        .card.shuffling { transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .card.settling { transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .card-modal {
            position: fixed; inset: 0; background: hsl(var(--background) / 0.8);
            backdrop-filter: blur(4px); display: flex; align-items: center;
            justify-content: center; z-index: 1000; opacity: 0; visibility: hidden;
            transition: all 0.2s ease;
        }
        .card-modal.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: hsl(var(--card)); border: 1px solid hsl(var(--border));
            border-radius: var(--radius); padding: 2rem; text-align: center;
            transform: scale(0.95) translateY(10px); transition: transform 0.2s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); max-width: 400px; width: 90%;
            max-height: 85vh; overflow-y: auto;
            user-select: text;
            -webkit-user-select: text;
        }
        .card-modal.active .modal-content { transform: scale(1) translateY(0); }
        .modal-card {
            width: 180px; height: 290px; margin: 0 auto 1.25rem; border-radius: var(--radius);
            overflow: hidden; background: hsl(var(--muted)); display: flex;
            align-items: center; justify-content: center; border: 1px solid hsl(var(--border));
        }
        .modal-card img { width: 100%; height: 100%; object-fit: cover; }
        .modal-placeholder { text-align: center; padding: 1.5rem; }
        .modal-placeholder .card-number { font-size: 3rem; font-weight: 600; margin-bottom: 0.5rem; }
        .modal-placeholder .card-suit { font-size: 0.875rem; color: hsl(var(--muted-foreground)); text-transform: uppercase; letter-spacing: 0.05em; }
        .modal-title { font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; }
        .modal-subtitle { font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 1rem; }
        .modal-meanings { text-align: left; }
        .keywords-section { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; padding: 0.75rem; background: hsl(var(--muted) / 0.5); border-radius: calc(var(--radius) - 2px); }
        .keywords-upright, .keywords-reversed { display: flex; align-items: flex-start; gap: 0.5rem; }
        .keywords-label { font-size: 0.625rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: hsl(var(--muted-foreground)); min-width: 52px; padding-top: 0.125rem; }
        .keywords-upright .keywords-label { color: hsl(142 76% 36%); }
        .keywords-reversed .keywords-label { color: hsl(0 72% 51%); }
        .keywords-list { font-size: 0.8125rem; color: hsl(var(--foreground)); line-height: 1.4; }
        .meaning-text { font-size: 0.875rem; line-height: 1.6; color: hsl(var(--foreground) / 0.85); }
        .modal-close {
            position: absolute; top: 1rem; right: 1rem; width: 2rem; height: 2rem;
            display: flex; align-items: center; justify-content: center;
            background: hsl(var(--card)); border: 1px solid hsl(var(--border));
            border-radius: var(--radius); color: hsl(var(--foreground));
            font-size: 1.25rem; cursor: pointer; transition: background 0.15s;
        }
        .modal-close:hover { background: hsl(var(--accent)); }
        .dev-panel {
            position: fixed; bottom: 0; left: 0; right: 0; background: hsl(var(--card));
            border-top: 1px solid hsl(var(--border)); padding: 0.875rem 1rem;
            transform: translateY(100%); transition: transform 0.2s ease;
            max-height: 22vh; overflow-y: auto; z-index: 500;
        }
        body.dev-mode .dev-panel { transform: translateY(0); }
        .dev-panel h3 { font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem; }
        .dev-info { display: flex; flex-wrap: wrap; gap: 0.25rem; font-size: 0.5625rem; font-family: ui-monospace, monospace; }
        .dev-info span { background: hsl(var(--muted)); padding: 2px 5px; border-radius: 2px; }
        .dev-info span.duplicate { background: hsl(0 84% 60% / 0.15); color: hsl(0 84% 50%); }
        .validation-status { margin-top: 0.5rem; padding: 0.375rem 0.625rem; border-radius: var(--radius); font-size: 0.6875rem; font-family: ui-monospace, monospace; }
        .validation-status.valid { background: hsl(142 76% 36% / 0.1); color: hsl(142 70% 35%); }
        .validation-status.invalid { background: hsl(0 84% 60% / 0.1); color: hsl(0 84% 50%); }
        .instructions { text-align: center; font-size: 0.75rem; color: hsl(var(--muted-foreground) / 0.7); pointer-events: none; padding: 0.5rem 0; }
        .icon { width: 1rem; height: 1rem; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Tarot Reader</h1>
            <div class="controls">
                <div class="toggle-group">
                    <span class="toggle-label">Reversals</span>
                    <div class="toggle" id="reversalsToggle"></div>
                </div>
                <div class="toggle-group">
                    <span class="toggle-label">Dev</span>
                    <div class="toggle" id="devToggle"></div>
                </div>
                <button class="btn btn-ghost" id="themeToggle" title="Toggle theme">
                    <svg class="icon" id="themeIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </button>
            </div>
        </header>
        <main>
            <div class="reading-surface" id="readingSurface"></div>
            <div class="deck-area">
                <div class="deck-container" id="deckContainer"></div>
            </div>
            <div class="deck-controls">
                <button class="btn btn-outline" id="shuffleBtn" title="Shuffle">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
                <button class="btn btn-outline" id="resetBtn" title="Return Cards">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h10a5 5 0 015 5v0a5 5 0 01-5 5H3m0-10l4-4m-4 4l4 4" />
                    </svg>
                </button>
            </div>
            <p class="instructions">Drag cards to the reading surface · Click to reveal</p>
        </main>
    </div>
    <div class="card-modal" id="cardModal">
        <button class="modal-close" id="modalClose">×</button>
        <div class="modal-content">
            <div class="modal-card" id="modalCard"></div>
            <h2 class="modal-title" id="modalTitle"></h2>
            <p class="modal-subtitle" id="modalSubtitle"></p>
            <div class="modal-meanings" id="modalMeanings">
                <div class="keywords-section">
                    <div class="keywords-upright">
                        <span class="keywords-label">Upright</span>
                        <span class="keywords-list" id="keywordsUpright"></span>
                    </div>
                    <div class="keywords-reversed">
                        <span class="keywords-label">Reversed</span>
                        <span class="keywords-list" id="keywordsReversed"></span>
                    </div>
                </div>
                <div class="meaning-text" id="meaningText"></div>
            </div>
        </div>
    </div>
    <div class="dev-panel">
        <h3>Deck Validation</h3>
        <div class="dev-info" id="devInfo"></div>
        <div class="validation-status" id="validationStatus"></div>
    </div>
</body>
<script>
// ============================================
// IMAGE CONFIGURATION
// ============================================
const USE_IMAGES = true;

function getCardImageUrl(card) {
    const baseUrl = 'https://steve-p.org/cards/small/sm_RWSa-';
    
    if (card.arcana === 'Major') {
        // Major Arcana: T-00 to T-21
        return `${baseUrl}T-${card.number.toString().padStart(2, '0')}.webp`;
    }
    
    // Minor Arcana suit codes
    const suitCode = { Wands: 'W', Cups: 'C', Swords: 'S', Pentacles: 'P' }[card.suit];
    
    // Number/court mapping
    let numCode;
    if (card.number === 1) {
        numCode = '0A'; // Ace
    } else if (card.number <= 10) {
        numCode = card.number.toString().padStart(2, '0');
    } else if (card.number === 11) {
        numCode = 'J1'; // Page
    } else if (card.number === 12) {
        numCode = 'J2'; // Knight
    } else if (card.number === 13) {
        numCode = 'QU'; // Queen
    } else if (card.number === 14) {
        numCode = 'KI'; // King
    }
    
    return `${baseUrl}${suitCode}-${numCode}.webp`;
}

// Full 78-card Rider-Waite deck
const TAROT_DECK = [
    // Major Arcana (22)
    { id: 'major-00', name: 'The Fool', arcana: 'Major', number: 0 },
    { id: 'major-01', name: 'The Magician', arcana: 'Major', number: 1 },
    { id: 'major-02', name: 'The High Priestess', arcana: 'Major', number: 2 },
    { id: 'major-03', name: 'The Empress', arcana: 'Major', number: 3 },
    { id: 'major-04', name: 'The Emperor', arcana: 'Major', number: 4 },
    { id: 'major-05', name: 'The Hierophant', arcana: 'Major', number: 5 },
    { id: 'major-06', name: 'The Lovers', arcana: 'Major', number: 6 },
    { id: 'major-07', name: 'The Chariot', arcana: 'Major', number: 7 },
    { id: 'major-08', name: 'Strength', arcana: 'Major', number: 8 },
    { id: 'major-09', name: 'The Hermit', arcana: 'Major', number: 9 },
    { id: 'major-10', name: 'Wheel of Fortune', arcana: 'Major', number: 10 },
    { id: 'major-11', name: 'Justice', arcana: 'Major', number: 11 },
    { id: 'major-12', name: 'The Hanged Man', arcana: 'Major', number: 12 },
    { id: 'major-13', name: 'Death', arcana: 'Major', number: 13 },
    { id: 'major-14', name: 'Temperance', arcana: 'Major', number: 14 },
    { id: 'major-15', name: 'The Devil', arcana: 'Major', number: 15 },
    { id: 'major-16', name: 'The Tower', arcana: 'Major', number: 16 },
    { id: 'major-17', name: 'The Star', arcana: 'Major', number: 17 },
    { id: 'major-18', name: 'The Moon', arcana: 'Major', number: 18 },
    { id: 'major-19', name: 'The Sun', arcana: 'Major', number: 19 },
    { id: 'major-20', name: 'Judgement', arcana: 'Major', number: 20 },
    { id: 'major-21', name: 'The World', arcana: 'Major', number: 21 },
    // Wands (14)
    { id: 'wands-01', name: 'Ace of Wands', arcana: 'Minor', suit: 'Wands', number: 1 },
    { id: 'wands-02', name: 'Two of Wands', arcana: 'Minor', suit: 'Wands', number: 2 },
    { id: 'wands-03', name: 'Three of Wands', arcana: 'Minor', suit: 'Wands', number: 3 },
    { id: 'wands-04', name: 'Four of Wands', arcana: 'Minor', suit: 'Wands', number: 4 },
    { id: 'wands-05', name: 'Five of Wands', arcana: 'Minor', suit: 'Wands', number: 5 },
    { id: 'wands-06', name: 'Six of Wands', arcana: 'Minor', suit: 'Wands', number: 6 },
    { id: 'wands-07', name: 'Seven of Wands', arcana: 'Minor', suit: 'Wands', number: 7 },
    { id: 'wands-08', name: 'Eight of Wands', arcana: 'Minor', suit: 'Wands', number: 8 },
    { id: 'wands-09', name: 'Nine of Wands', arcana: 'Minor', suit: 'Wands', number: 9 },
    { id: 'wands-10', name: 'Ten of Wands', arcana: 'Minor', suit: 'Wands', number: 10 },
    { id: 'wands-11', name: 'Page of Wands', arcana: 'Minor', suit: 'Wands', number: 11 },
    { id: 'wands-12', name: 'Knight of Wands', arcana: 'Minor', suit: 'Wands', number: 12 },
    { id: 'wands-13', name: 'Queen of Wands', arcana: 'Minor', suit: 'Wands', number: 13 },
    { id: 'wands-14', name: 'King of Wands', arcana: 'Minor', suit: 'Wands', number: 14 },
    // Cups (14)
    { id: 'cups-01', name: 'Ace of Cups', arcana: 'Minor', suit: 'Cups', number: 1 },
    { id: 'cups-02', name: 'Two of Cups', arcana: 'Minor', suit: 'Cups', number: 2 },
    { id: 'cups-03', name: 'Three of Cups', arcana: 'Minor', suit: 'Cups', number: 3 },
    { id: 'cups-04', name: 'Four of Cups', arcana: 'Minor', suit: 'Cups', number: 4 },
    { id: 'cups-05', name: 'Five of Cups', arcana: 'Minor', suit: 'Cups', number: 5 },
    { id: 'cups-06', name: 'Six of Cups', arcana: 'Minor', suit: 'Cups', number: 6 },
    { id: 'cups-07', name: 'Seven of Cups', arcana: 'Minor', suit: 'Cups', number: 7 },
    { id: 'cups-08', name: 'Eight of Cups', arcana: 'Minor', suit: 'Cups', number: 8 },
    { id: 'cups-09', name: 'Nine of Cups', arcana: 'Minor', suit: 'Cups', number: 9 },
    { id: 'cups-10', name: 'Ten of Cups', arcana: 'Minor', suit: 'Cups', number: 10 },
    { id: 'cups-11', name: 'Page of Cups', arcana: 'Minor', suit: 'Cups', number: 11 },
    { id: 'cups-12', name: 'Knight of Cups', arcana: 'Minor', suit: 'Cups', number: 12 },
    { id: 'cups-13', name: 'Queen of Cups', arcana: 'Minor', suit: 'Cups', number: 13 },
    { id: 'cups-14', name: 'King of Cups', arcana: 'Minor', suit: 'Cups', number: 14 },
    // Swords (14)
    { id: 'swords-01', name: 'Ace of Swords', arcana: 'Minor', suit: 'Swords', number: 1 },
    { id: 'swords-02', name: 'Two of Swords', arcana: 'Minor', suit: 'Swords', number: 2 },
    { id: 'swords-03', name: 'Three of Swords', arcana: 'Minor', suit: 'Swords', number: 3 },
    { id: 'swords-04', name: 'Four of Swords', arcana: 'Minor', suit: 'Swords', number: 4 },
    { id: 'swords-05', name: 'Five of Swords', arcana: 'Minor', suit: 'Swords', number: 5 },
    { id: 'swords-06', name: 'Six of Swords', arcana: 'Minor', suit: 'Swords', number: 6 },
    { id: 'swords-07', name: 'Seven of Swords', arcana: 'Minor', suit: 'Swords', number: 7 },
    { id: 'swords-08', name: 'Eight of Swords', arcana: 'Minor', suit: 'Swords', number: 8 },
    { id: 'swords-09', name: 'Nine of Swords', arcana: 'Minor', suit: 'Swords', number: 9 },
    { id: 'swords-10', name: 'Ten of Swords', arcana: 'Minor', suit: 'Swords', number: 10 },
    { id: 'swords-11', name: 'Page of Swords', arcana: 'Minor', suit: 'Swords', number: 11 },
    { id: 'swords-12', name: 'Knight of Swords', arcana: 'Minor', suit: 'Swords', number: 12 },
    { id: 'swords-13', name: 'Queen of Swords', arcana: 'Minor', suit: 'Swords', number: 13 },
    { id: 'swords-14', name: 'King of Swords', arcana: 'Minor', suit: 'Swords', number: 14 },
    // Pentacles (14)
    { id: 'pentacles-01', name: 'Ace of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 1 },
    { id: 'pentacles-02', name: 'Two of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 2 },
    { id: 'pentacles-03', name: 'Three of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 3 },
    { id: 'pentacles-04', name: 'Four of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 4 },
    { id: 'pentacles-05', name: 'Five of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 5 },
    { id: 'pentacles-06', name: 'Six of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 6 },
    { id: 'pentacles-07', name: 'Seven of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 7 },
    { id: 'pentacles-08', name: 'Eight of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 8 },
    { id: 'pentacles-09', name: 'Nine of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 9 },
    { id: 'pentacles-10', name: 'Ten of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 10 },
    { id: 'pentacles-11', name: 'Page of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 11 },
    { id: 'pentacles-12', name: 'Knight of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 12 },
    { id: 'pentacles-13', name: 'Queen of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 13 },
    { id: 'pentacles-14', name: 'King of Pentacles', arcana: 'Minor', suit: 'Pentacles', number: 14 },
];

// Card meanings data (source: Labyrinthos.co)
const TAROT_MEANINGS = {
    "major-00": {
        keywords: { upright: ["innocence", "new beginnings", "free spirit", "adventure"], reversed: ["recklessness", "taken advantage of", "inconsideration", "naivety"] },
        upright: "A beginning of a new journey filled with optimism and freedom. Every day is a chance to open up new areas in your life with anticipation, wonder, and curiosity.",
        reversed: "Acting without considering repercussions. Living in the moment without planning for the future. Be more aware so as not to be taken advantage of."
    },
    "major-01": {
        keywords: { upright: ["willpower", "desire", "creation", "manifestation"], reversed: ["trickery", "illusions", "out of touch", "manipulation"] },
        upright: "Making things manifest through skill, creativity, and determination. The power to turn ideas into action by utilizing your talents and inner resources.",
        reversed: "Untapped talents or using skills for deceptive purposes. Manipulation or illusions may be at work."
    },
    "major-02": {
        keywords: { upright: ["intuition", "unconscious", "inner voice", "mystery"], reversed: ["lack of center", "lost inner voice", "repressed feelings"] },
        upright: "Trust your intuition and inner voice. A time for introspection, meditation, and listening to your subconscious.",
        reversed: "Disconnection from intuition, ignoring your inner voice, or secrets being kept. Time to reconnect with your spiritual self."
    },
    "major-03": {
        keywords: { upright: ["motherhood", "fertility", "nature", "abundance"], reversed: ["dependence", "smothering", "emptiness", "creative block"] },
        upright: "Abundance, fertility, and nurturing energy. A time of creativity, growth, and connection with nature.",
        reversed: "Creative blocks, dependence on others, or feeling disconnected from your nurturing side."
    },
    "major-04": {
        keywords: { upright: ["authority", "structure", "control", "stability"], reversed: ["tyranny", "rigidity", "coldness", "domination"] },
        upright: "Authority, structure, and solid foundations. Leadership and the ability to achieve goals through organization.",
        reversed: "Excessive control, domination, or lack of discipline. May indicate an abuse of authority."
    },
    "major-05": {
        keywords: { upright: ["tradition", "conformity", "morality", "spiritual wisdom"], reversed: ["rebellion", "subversiveness", "new approaches"] },
        upright: "Seeking spiritual wisdom through conventional means. Education, mentorship, and following established paths.",
        reversed: "Challenging traditions or seeking unconventional spiritual paths. Time for new approaches."
    },
    "major-06": {
        keywords: { upright: ["partnerships", "duality", "union", "choices"], reversed: ["loss of balance", "one-sidedness", "disharmony"] },
        upright: "Union, partnership, and important choices. Alignment of values and harmony in relationships.",
        reversed: "Disharmony, imbalance in relationships, or facing a difficult choice."
    },
    "major-07": {
        keywords: { upright: ["direction", "control", "willpower", "victory"], reversed: ["lack of control", "lack of direction", "aggression"] },
        upright: "Victory through willpower and determination. Control over opposing forces and achievement of goals.",
        reversed: "Lack of direction, feeling out of control, or aggression without purpose."
    },
    "major-08": {
        keywords: { upright: ["inner strength", "bravery", "compassion", "courage"], reversed: ["self doubt", "weakness", "insecurity"] },
        upright: "Inner strength and patience. Mastery over base instincts through compassion rather than force.",
        reversed: "Self-doubt, weakness, or lack of confidence. Difficulty controlling emotions."
    },
    "major-09": {
        keywords: { upright: ["contemplation", "search for truth", "inner guidance"], reversed: ["loneliness", "isolation", "lost your way"] },
        upright: "Soul-searching, introspection, and seeking inner guidance. A time for solitude and reflection.",
        reversed: "Excessive isolation or losing your way. Fear of introspection."
    },
    "major-10": {
        keywords: { upright: ["change", "cycles", "inevitable fate", "turning point"], reversed: ["no control", "clinging to control", "bad luck"] },
        upright: "A turning point and the cyclical nature of life. Destiny and karma at work. Embrace coming changes.",
        reversed: "Resistance to change or feeling like you have no control. This too shall pass."
    },
    "major-11": {
        keywords: { upright: ["cause and effect", "clarity", "truth", "fairness"], reversed: ["dishonesty", "unaccountability", "unfairness"] },
        upright: "Truth, fairness, and the law of cause and effect. Accountability and consequences of actions.",
        reversed: "Injustice, dishonesty, or lack of accountability."
    },
    "major-12": {
        keywords: { upright: ["sacrifice", "release", "martyrdom", "new perspective"], reversed: ["stalling", "needless sacrifice", "fear of sacrifice"] },
        upright: "Suspension, sacrifice, and letting go. Seeing things from a new perspective.",
        reversed: "Stalling, resistance to necessary sacrifice, or fear of letting go."
    },
    "major-13": {
        keywords: { upright: ["end of cycle", "beginnings", "change", "transformation"], reversed: ["fear of change", "holding on", "stagnation"] },
        upright: "Endings and beginnings, transformation and transition. The end of one cycle and start of another.",
        reversed: "Resistance to change or holding onto what no longer serves you."
    },
    "major-14": {
        keywords: { upright: ["middle path", "patience", "finding meaning", "balance"], reversed: ["extremes", "excess", "lack of balance"] },
        upright: "Balance, moderation, and patience. Finding the middle path and mixing elements in harmony.",
        reversed: "Imbalance, excess, or going to extremes."
    },
    "major-15": {
        keywords: { upright: ["addiction", "materialism", "playfulness", "shadow self"], reversed: ["freedom", "release", "restoring control"] },
        upright: "Bondage to material things or shadow aspects of self. Can also represent playfulness.",
        reversed: "Breaking free from bondage or reclaiming control over your life."
    },
    "major-16": {
        keywords: { upright: ["sudden upheaval", "broken pride", "disaster", "revelation"], reversed: ["disaster avoided", "delayed disaster", "fear of suffering"] },
        upright: "Sudden change and the destruction of false beliefs. A necessary breakdown before breakthrough.",
        reversed: "Avoiding disaster or internal transformation rather than external chaos."
    },
    "major-17": {
        keywords: { upright: ["hope", "faith", "rejuvenation", "serenity"], reversed: ["faithlessness", "discouragement", "insecurity"] },
        upright: "Hope, faith, and renewal after difficulty. Inspiration and connection to the divine.",
        reversed: "Loss of faith, discouragement, or feeling disconnected from hope."
    },
    "major-18": {
        keywords: { upright: ["unconscious", "illusions", "intuition", "dreams"], reversed: ["confusion", "fear", "misinterpretation"] },
        upright: "Illusion and the unconscious mind. Things are not as they seem. Trust your instincts.",
        reversed: "Confusion lifting or fears being confronted. Clarity emerging from darkness."
    },
    "major-19": {
        keywords: { upright: ["joy", "success", "celebration", "positivity"], reversed: ["negativity", "depression", "sadness"] },
        upright: "Joy, success, and positivity. Celebration and everything coming together harmoniously.",
        reversed: "Temporary depression or blocked happiness. The sun is still there."
    },
    "major-20": {
        keywords: { upright: ["reflection", "reckoning", "awakening", "renewal"], reversed: ["lack of self awareness", "doubt", "self loathing"] },
        upright: "Reflection and spiritual awakening. Answering a calling or experiencing rebirth.",
        reversed: "Lack of self-awareness or refusing to learn from the past."
    },
    "major-21": {
        keywords: { upright: ["fulfillment", "harmony", "completion", "accomplishment"], reversed: ["incompletion", "no closure", "lack of achievement"] },
        upright: "Completion, fulfillment, and wholeness. The successful end of a cycle.",
        reversed: "Incompletion or feeling like something is missing."
    },
    "wands-01": {
        keywords: { upright: ["creation", "willpower", "inspiration", "desire"], reversed: ["lack of energy", "lack of passion", "boredom"] },
        upright: "A new beginning filled with inspiration and creative energy. The spark of a new idea.",
        reversed: "Lack of energy, creative blocks, or delays in new ventures."
    },
    "wands-02": {
        keywords: { upright: ["planning", "making decisions", "leaving home"], reversed: ["fear of change", "playing safe", "bad planning"] },
        upright: "Planning for the future and making decisions about which path to take.",
        reversed: "Fear of the unknown or reluctance to leave your comfort zone."
    },
    "wands-03": {
        keywords: { upright: ["looking ahead", "expansion", "rapid growth"], reversed: ["obstacles", "delays", "frustration"] },
        upright: "Expansion and looking ahead to future opportunities. Progress is being made.",
        reversed: "Delays, obstacles, or frustration with the pace of progress."
    },
    "wands-04": {
        keywords: { upright: ["community", "home", "celebration", "harmony"], reversed: ["lack of support", "transience", "home conflicts"] },
        upright: "Celebration, homecoming, and community. A milestone achieved.",
        reversed: "Lack of support or conflicts at home."
    },
    "wands-05": {
        keywords: { upright: ["competition", "rivalry", "conflict"], reversed: ["avoiding conflict", "respecting differences"] },
        upright: "Competition and differing opinions. Healthy rivalry or frustrating disagreements.",
        reversed: "Avoiding conflict or finding common ground."
    },
    "wands-06": {
        keywords: { upright: ["victory", "success", "public reward"], reversed: ["excess pride", "lack of recognition", "fall from grace"] },
        upright: "Victory and public recognition. Your efforts are being acknowledged.",
        reversed: "Lack of recognition or success that feels hollow."
    },
    "wands-07": {
        keywords: { upright: ["perseverance", "defensive", "maintaining control"], reversed: ["give up", "destroyed confidence", "overwhelmed"] },
        upright: "Standing your ground and persevering despite opposition.",
        reversed: "Feeling overwhelmed or losing confidence."
    },
    "wands-08": {
        keywords: { upright: ["rapid action", "movement", "quick decisions"], reversed: ["panic", "waiting", "slowdown"] },
        upright: "Rapid movement and things happening quickly. Travel and momentum.",
        reversed: "Delays or feeling stuck."
    },
    "wands-09": {
        keywords: { upright: ["resilience", "grit", "last stand"], reversed: ["exhaustion", "fatigue", "questioning motivations"] },
        upright: "Resilience and determination. You've been through challenges but are still standing.",
        reversed: "Exhaustion or questioning whether it's worth continuing."
    },
    "wands-10": {
        keywords: { upright: ["accomplishment", "responsibility", "burden"], reversed: ["inability to delegate", "overstressed", "burnt out"] },
        upright: "Heavy burdens and responsibility. You may be taking on too much.",
        reversed: "Burnout or being crushed by responsibilities."
    },
    "wands-11": {
        keywords: { upright: ["exploration", "excitement", "freedom"], reversed: ["lack of direction", "procrastination", "creating conflict"] },
        upright: "Exploration and discovering new passions. A message about creativity.",
        reversed: "Lack of direction or enthusiasm without follow-through."
    },
    "wands-12": {
        keywords: { upright: ["action", "adventure", "fearlessness"], reversed: ["anger", "impulsiveness", "recklessness"] },
        upright: "Energy, passion, and charging forward fearlessly toward goals.",
        reversed: "Recklessness or energy that's scattered."
    },
    "wands-13": {
        keywords: { upright: ["courage", "determination", "joy"], reversed: ["selfishness", "jealousy", "insecurities"] },
        upright: "Confidence and warmth. Someone who inspires others with courage and joy.",
        reversed: "Jealousy or insecurity masked by bravado."
    },
    "wands-14": {
        keywords: { upright: ["big picture", "leader", "overcoming challenges"], reversed: ["impulsive", "overbearing", "unachievable expectations"] },
        upright: "Visionary leadership and seeing the big picture. Inspiring action.",
        reversed: "Impulsive decisions or setting unrealistic expectations."
    },
    "cups-01": {
        keywords: { upright: ["new feelings", "spirituality", "intuition"], reversed: ["emotional loss", "blocked creativity", "emptiness"] },
        upright: "New emotional beginnings and spiritual connection. Overflowing feelings.",
        reversed: "Emotional blockages or spiritual disconnection."
    },
    "cups-02": {
        keywords: { upright: ["unity", "partnership", "connection"], reversed: ["imbalance", "broken communication", "tension"] },
        upright: "Partnership and deep connection. The beginning of a meaningful relationship.",
        reversed: "Imbalance in relationships or broken communication."
    },
    "cups-03": {
        keywords: { upright: ["friendship", "community", "happiness"], reversed: ["overindulgence", "gossip", "isolation"] },
        upright: "Celebration, friendship, and shared joy.",
        reversed: "Overindulgence or feeling isolated from community."
    },
    "cups-04": {
        keywords: { upright: ["apathy", "contemplation", "disconnectedness"], reversed: ["sudden awareness", "choosing happiness", "acceptance"] },
        upright: "Contemplation or missing opportunities. A need for introspection.",
        reversed: "Sudden awareness or choosing to engage with life again."
    },
    "cups-05": {
        keywords: { upright: ["loss", "grief", "self-pity"], reversed: ["acceptance", "moving on", "finding peace"] },
        upright: "Loss and focusing on what's gone rather than what remains.",
        reversed: "Acceptance and moving on from loss."
    },
    "cups-06": {
        keywords: { upright: ["familiarity", "happy memories", "healing"], reversed: ["moving forward", "leaving home", "independence"] },
        upright: "Nostalgia and happy memories. Healing through familiar comfort.",
        reversed: "Leaving the past behind and gaining independence."
    },
    "cups-07": {
        keywords: { upright: ["searching for purpose", "choices", "daydreaming"], reversed: ["lack of purpose", "diversion", "confusion"] },
        upright: "Many options before you. Discernment needed to separate illusion from reality.",
        reversed: "Overwhelm from too many choices or lacking clear purpose."
    },
    "cups-08": {
        keywords: { upright: ["walking away", "disillusionment", "leaving behind"], reversed: ["avoidance", "fear of change", "fear of loss"] },
        upright: "Walking away from what no longer serves you. Seeking deeper meaning.",
        reversed: "Fear of leaving or avoidance of necessary change."
    },
    "cups-09": {
        keywords: { upright: ["satisfaction", "emotional stability", "luxury"], reversed: ["lack of inner joy", "smugness", "dissatisfaction"] },
        upright: "Emotional satisfaction and wishes coming true. Enjoying your efforts.",
        reversed: "Superficial happiness or dissatisfaction despite having what you wanted."
    },
    "cups-10": {
        keywords: { upright: ["inner happiness", "fulfillment", "dreams coming true"], reversed: ["shattered dreams", "broken family", "domestic disharmony"] },
        upright: "Emotional fulfillment and lasting happiness.",
        reversed: "Family discord or broken dreams."
    },
    "cups-11": {
        keywords: { upright: ["happy surprise", "dreamer", "sensitivity"], reversed: ["emotional immaturity", "insecurity", "disappointment"] },
        upright: "Creative opportunities and emotional sensitivity. A dreamer.",
        reversed: "Emotional immaturity or sensitivity without boundaries."
    },
    "cups-12": {
        keywords: { upright: ["following the heart", "idealist", "romantic"], reversed: ["moodiness", "disappointment", "unrealistic expectations"] },
        upright: "Following your heart and seeking beauty. An idealistic person.",
        reversed: "Moodiness or unrealistic romantic expectations."
    },
    "cups-13": {
        keywords: { upright: ["compassion", "calm", "comfort"], reversed: ["martyrdom", "insecurity", "dependence"] },
        upright: "Compassion and emotional security. A nurturing presence.",
        reversed: "Emotional insecurity or giving too much at your own expense."
    },
    "cups-14": {
        keywords: { upright: ["compassion", "control", "balance"], reversed: ["coldness", "moodiness", "bad advice"] },
        upright: "Emotional balance and diplomacy. Mastery over emotions while remaining caring.",
        reversed: "Emotional manipulation or using emotional intelligence selfishly."
    },
    "swords-01": {
        keywords: { upright: ["breakthrough", "clarity", "sharp mind"], reversed: ["confusion", "brutality", "chaos"] },
        upright: "Mental clarity and breakthrough. The power of truth and understanding.",
        reversed: "Confusion or using intellect cruelly."
    },
    "swords-02": {
        keywords: { upright: ["difficult choices", "indecision", "stalemate"], reversed: ["lesser of two evils", "no right choice", "confusion"] },
        upright: "Difficult decisions and being caught between two options.",
        reversed: "Forced choice or finally making a decision you've been avoiding."
    },
    "swords-03": {
        keywords: { upright: ["heartbreak", "suffering", "grief"], reversed: ["recovery", "forgiveness", "moving on"] },
        upright: "Heartbreak and emotional pain from loss or betrayal.",
        reversed: "Recovery from heartbreak and the healing process beginning."
    },
    "swords-04": {
        keywords: { upright: ["rest", "restoration", "contemplation"], reversed: ["restlessness", "burnout", "stress"] },
        upright: "Rest and recovery. A necessary period to heal and restore energy.",
        reversed: "Restlessness or burnout from not taking needed breaks."
    },
    "swords-05": {
        keywords: { upright: ["unbridled ambition", "win at all costs", "sneakiness"], reversed: ["lingering resentment", "desire to reconcile", "forgiveness"] },
        upright: "Conflict and winning at any cost. A hollow victory.",
        reversed: "Desire to reconcile or letting go of conflict."
    },
    "swords-06": {
        keywords: { upright: ["transition", "leaving behind", "moving on"], reversed: ["emotional baggage", "unresolved issues", "resisting transition"] },
        upright: "Transition and moving away from difficulty. A journey toward calmer waters.",
        reversed: "Resisting necessary change or carrying emotional baggage."
    },
    "swords-07": {
        keywords: { upright: ["deception", "trickery", "tactics and strategy"], reversed: ["coming clean", "rethinking approach", "deception revealed"] },
        upright: "Deception and using cunning to achieve goals.",
        reversed: "Deception revealed or rethinking a sneaky approach."
    },
    "swords-08": {
        keywords: { upright: ["imprisonment", "entrapment", "self-victimization"], reversed: ["self acceptance", "new perspective", "freedom"] },
        upright: "Feeling trapped. Often the imprisonment is self-imposed.",
        reversed: "Freedom from mental prison or realizing you had the power to leave."
    },
    "swords-09": {
        keywords: { upright: ["anxiety", "hopelessness", "trauma"], reversed: ["hope", "reaching out", "despair lifting"] },
        upright: "Anxiety and worry. The darkest hour when fears seem overwhelming.",
        reversed: "Light at the end of the tunnel or anxiety beginning to lift."
    },
    "swords-10": {
        keywords: { upright: ["failure", "collapse", "defeat"], reversed: ["can't get worse", "only upwards", "inevitable end"] },
        upright: "Rock bottom. The worst has happened, but now there's nowhere to go but up.",
        reversed: "The worst is over or recovery beginning."
    },
    "swords-11": {
        keywords: { upright: ["curiosity", "restlessness", "mental energy"], reversed: ["deception", "manipulation", "all talk"] },
        upright: "Curiosity and new ideas. A messenger bringing intellectual challenges.",
        reversed: "All talk and no action or using words to manipulate."
    },
    "swords-12": {
        keywords: { upright: ["action", "impulsiveness", "defending beliefs"], reversed: ["no direction", "disregard for consequences", "unpredictability"] },
        upright: "Swift action and charging forward. Someone who acts quickly on ideas.",
        reversed: "Reckless action or disregard for consequences."
    },
    "swords-13": {
        keywords: { upright: ["complexity", "perceptiveness", "clear mindedness"], reversed: ["cold hearted", "cruel", "bitterness"] },
        upright: "Clear thinking and direct communication. Seeing through deception.",
        reversed: "Coldness or using sharp intellect to hurt others."
    },
    "swords-14": {
        keywords: { upright: ["head over heart", "discipline", "truth"], reversed: ["manipulative", "cruel", "weakness"] },
        upright: "Intellectual authority and clear judgment. Leading with logic.",
        reversed: "Manipulation through intellect or tyrannical use of power."
    },
    "pentacles-01": {
        keywords: { upright: ["opportunity", "prosperity", "new venture"], reversed: ["lost opportunity", "missed chance", "bad investment"] },
        upright: "New financial or material opportunity. The seed of prosperity.",
        reversed: "Missed opportunity or failed financial venture."
    },
    "pentacles-02": {
        keywords: { upright: ["balancing decisions", "priorities", "adapting to change"], reversed: ["loss of balance", "disorganized", "overwhelmed"] },
        upright: "Juggling priorities and managing responsibilities with flexibility.",
        reversed: "Loss of balance or dropping the ball on important matters."
    },
    "pentacles-03": {
        keywords: { upright: ["teamwork", "collaboration", "building"], reversed: ["lack of teamwork", "disorganized", "group conflict"] },
        upright: "Collaboration and skilled work. Teamwork leading to quality results.",
        reversed: "Lack of cooperation or conflicts within a team."
    },
    "pentacles-04": {
        keywords: { upright: ["conservation", "frugality", "security"], reversed: ["greediness", "stinginess", "possessiveness"] },
        upright: "Security and protecting what you have, sometimes too tightly.",
        reversed: "Greed or holding on too tightly to possessions."
    },
    "pentacles-05": {
        keywords: { upright: ["need", "poverty", "insecurity"], reversed: ["recovery", "charity", "improvement"] },
        upright: "Financial hardship or feeling left out in the cold.",
        reversed: "Recovery from hardship or finding help."
    },
    "pentacles-06": {
        keywords: { upright: ["charity", "generosity", "sharing"], reversed: ["strings attached", "stinginess", "power and domination"] },
        upright: "Generosity and the balance of giving and receiving.",
        reversed: "Generosity with strings attached or using charity for power."
    },
    "pentacles-07": {
        keywords: { upright: ["hard work", "perseverance", "diligence"], reversed: ["work without results", "distractions", "lack of rewards"] },
        upright: "Patience and evaluating progress. Taking the long view.",
        reversed: "Frustration with slow progress or lack of results."
    },
    "pentacles-08": {
        keywords: { upright: ["apprenticeship", "passion", "high standards"], reversed: ["lack of passion", "uninspired", "no motivation"] },
        upright: "Skill development and dedication to craft.",
        reversed: "Lack of motivation or feeling uninspired."
    },
    "pentacles-09": {
        keywords: { upright: ["fruits of labor", "rewards", "luxury"], reversed: ["reckless spending", "living beyond means", "false success"] },
        upright: "Enjoying rewards of hard work. Material comfort and independence.",
        reversed: "Living beyond your means or hollow success."
    },
    "pentacles-10": {
        keywords: { upright: ["legacy", "culmination", "inheritance"], reversed: ["fleeting success", "lack of stability", "lack of resources"] },
        upright: "Legacy and family wealth. The culmination of material achievement.",
        reversed: "Family financial troubles or unstable foundations."
    },
    "pentacles-11": {
        keywords: { upright: ["ambition", "desire", "diligence"], reversed: ["lack of commitment", "greediness", "laziness"] },
        upright: "New opportunities for prosperity. A message about finances or career.",
        reversed: "Laziness or greed without the work to back it up."
    },
    "pentacles-12": {
        keywords: { upright: ["efficiency", "hard work", "responsibility"], reversed: ["laziness", "obsessiveness", "work without reward"] },
        upright: "Hard work and steady progress. Getting things done through dedication.",
        reversed: "Being stuck in routine or working without seeing results."
    },
    "pentacles-13": {
        keywords: { upright: ["practicality", "creature comforts", "financial security"], reversed: ["self-centeredness", "jealousy", "smothering"] },
        upright: "Practical nurturing and creating a comfortable home.",
        reversed: "Neglecting home life or jealousy over others' success."
    },
    "pentacles-14": {
        keywords: { upright: ["abundance", "prosperity", "security"], reversed: ["greed", "indulgence", "sensuality"] },
        upright: "Material success and abundance through discipline.",
        reversed: "Greed or using wealth for status rather than substance."
    }
};

function getDisplayNumber(card) {
    if (card.arcana === 'Major') return card.number.toString();
    const court = { 11: 'Pg', 12: 'Kn', 13: 'Q', 14: 'K' };
    return court[card.number] || card.number.toString();
}

function getCardFrontContent(card) {
    if (USE_IMAGES) {
        const url = getCardImageUrl(card);
        if (url) return `<img src="${url}" alt="${card.name}" loading="lazy">`;
    }
    return `<div class="card-placeholder"><div class="card-number">${getDisplayNumber(card)}</div><div class="card-suit">${card.suit || 'Major'}</div></div>`;
}

function getModalContent(card) {
    if (USE_IMAGES) {
        const url = getCardImageUrl(card);
        if (url) return `<img src="${url}" alt="${card.name}">`;
    }
    return `<div class="modal-placeholder"><div class="card-number">${getDisplayNumber(card)}</div><div class="card-suit">${card.suit || 'Major Arcana'}</div></div>`;
}

// State
let deck = [];
let placedCards = [];
let draggedCard = null;
let dragOffset = { x: 0, y: 0 };
let reversalsEnabled = false;

// DOM
const deckContainer = document.getElementById('deckContainer');
const readingSurface = document.getElementById('readingSurface');
const devToggle = document.getElementById('devToggle');
const reversalsToggle = document.getElementById('reversalsToggle');
const themeToggle = document.getElementById('themeToggle');
const shuffleBtn = document.getElementById('shuffleBtn');
const resetBtn = document.getElementById('resetBtn');
const cardModal = document.getElementById('cardModal');
const modalClose = document.getElementById('modalClose');
const devInfo = document.getElementById('devInfo');
const validationStatus = document.getElementById('validationStatus');

// Fisher-Yates with crypto
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const buf = new Uint32Array(1);
        crypto.getRandomValues(buf);
        const j = buf[0] % (i + 1);
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

function initializeDeck() {
    deck = shuffleArray([...TAROT_DECK]);
    placedCards = [];
    renderDeck();
    updateDevPanel();
}

function getCardDimensions() {
    const style = getComputedStyle(document.documentElement);
    const cardW = parseFloat(style.getPropertyValue('--deck-card-width')) || 56;
    const overlap = parseFloat(style.getPropertyValue('--card-overlap')) || 9;
    return { cardW, overlap };
}

function isMobileView() {
    return window.innerWidth <= 600;
}

function renderDeck() {
    deckContainer.innerHTML = '';
    const total = deck.length;
    const { cardW, overlap } = getCardDimensions();
    
    if (isMobileView() && total > 20) {
        // Two arched rows for mobile - both arch upward
        const half = Math.ceil(total / 2);
        const topRow = deck.slice(0, half);
        const bottomRow = deck.slice(half);
        
        const arcHeight = 20;
        const maxRotation = 15; // total fan spread in degrees
        
        // Top row (arched upward)
        const topTotalW = cardW + (topRow.length - 1) * overlap;
        const topStartX = -topTotalW / 2 + cardW / 2;
        
        topRow.forEach((card, i) => {
            const el = createCardElement(card, i);
            const xPos = topStartX + i * overlap;
            const progress = topRow.length > 1 ? i / (topRow.length - 1) : 0.5;
            const arcY = -Math.sin(progress * Math.PI) * arcHeight;
            const rotation = (progress - 0.5) * maxRotation * 2;
            
            el.style.left = '50%';
            el.style.top = '30%';
            el.style.transform = `translate(-50%, -50%) translateX(${xPos}px) translateY(${arcY}px) rotate(${rotation}deg)`;
            el.style.setProperty('--base-x', `${xPos}px`);
            el.style.setProperty('--base-y', `${arcY}px`);
            el.style.setProperty('--base-rot', `${rotation}deg`);
            el.style.zIndex = i;
            deckContainer.appendChild(el);
        });
        
        // Bottom row (also arched upward)
        const bottomTotalW = cardW + (bottomRow.length - 1) * overlap;
        const bottomStartX = -bottomTotalW / 2 + cardW / 2;
        
        bottomRow.forEach((card, i) => {
            const globalIndex = half + i;
            const el = createCardElement(card, globalIndex);
            const xPos = bottomStartX + i * overlap;
            const progress = bottomRow.length > 1 ? i / (bottomRow.length - 1) : 0.5;
            const arcY = -Math.sin(progress * Math.PI) * arcHeight;
            const rotation = (progress - 0.5) * maxRotation * 2;
            
            el.style.left = '50%';
            el.style.top = '72%';
            el.style.transform = `translate(-50%, -50%) translateX(${xPos}px) translateY(${arcY}px) rotate(${rotation}deg)`;
            el.style.setProperty('--base-x', `${xPos}px`);
            el.style.setProperty('--base-y', `${arcY}px`);
            el.style.setProperty('--base-rot', `${rotation}deg`);
            el.style.zIndex = globalIndex;
            deckContainer.appendChild(el);
        });
    } else {
        // Single row (desktop)
        const totalW = cardW + (total - 1) * overlap;
        const startX = -totalW / 2 + cardW / 2;

        deck.forEach((card, i) => {
            const el = createCardElement(card, i);
            const xPos = startX + i * overlap;
            el.style.left = '50%';
            el.style.top = '50%';
            el.style.transform = `translate(-50%, -50%) translateX(${xPos}px)`;
            el.style.setProperty('--base-x', `${xPos}px`);
            el.style.zIndex = i;
            deckContainer.appendChild(el);
        });
    }
}

function createCardElement(card, index) {
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.cardId = card.id;
    el.dataset.index = index;
    el.innerHTML = `
        <div class="card-face card-back"></div>
        <div class="card-face card-front">${getCardFrontContent(card)}</div>
        <div class="dev-label">${card.id}</div>
    `;
    el.addEventListener('mousedown', startDrag);
    el.addEventListener('touchstart', startDrag, { passive: false });
    return el;
}

function startDrag(e) {
    if (e.target.closest('.placed-card.flipped')) return;
    e.preventDefault();
    const el = e.target.closest('.card');
    if (!el) return;

    draggedCard = el;
    
    // Get current visual position before changing anything
    const rect = el.getBoundingClientRect();
    
    // Add dragging classes to disable hover effects
    draggedCard.classList.add('dragging');
    deckContainer.classList.add('dragging-active');
    
    // Store original styles to calculate position
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    // Apply fixed positioning
    draggedCard.style.position = 'fixed';
    draggedCard.style.left = centerX + 'px';
    draggedCard.style.top = centerY + 'px';
    draggedCard.style.transform = 'translate(-50%, -50%)';
    draggedCard.style.zIndex = '1000';

    const cx = e.clientX || e.touches[0].clientX;
    const cy = e.clientY || e.touches[0].clientY;
    dragOffset.x = cx - centerX;
    dragOffset.y = cy - centerY;

    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchmove', drag, { passive: false });
    document.addEventListener('touchend', endDrag);
}

function drag(e) {
    if (!draggedCard) return;
    e.preventDefault();
    const cx = e.clientX || e.touches[0].clientX;
    const cy = e.clientY || e.touches[0].clientY;
    draggedCard.style.left = (cx - dragOffset.x) + 'px';
    draggedCard.style.top = (cy - dragOffset.y) + 'px';
}

function endDrag(e) {
    if (!draggedCard) return;
    const cx = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);
    const cy = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);
    const surfaceRect = readingSurface.getBoundingClientRect();
    
    const droppedOnSurface = cx >= surfaceRect.left && cx <= surfaceRect.right && 
                             cy >= surfaceRect.top && cy <= surfaceRect.bottom;

    // Remove dragging state from container
    deckContainer.classList.remove('dragging-active');

    if (droppedOnSurface) {
        const cardId = draggedCard.dataset.cardId;
        const cardData = deck.find(c => c.id === cardId);
        if (cardData) {
            // Get placed card dimensions for centering
            const style = getComputedStyle(document.documentElement);
            const placedW = parseFloat(style.getPropertyValue('--placed-card-width')) || 100;
            const placedH = parseFloat(style.getPropertyValue('--placed-card-height')) || 160;
            placeCard(cardData, cx - surfaceRect.left - placedW / 2, cy - surfaceRect.top - placedH / 2);
            deck = deck.filter(c => c.id !== cardId);
            draggedCard.remove();
            updateDevPanel();
        }
    } else {
        // Return card to deck position
        draggedCard.classList.remove('dragging');
        draggedCard.style.position = '';
        draggedCard.style.left = '50%';
        draggedCard.style.top = '50%';
        draggedCard.style.zIndex = draggedCard.dataset.index;
        const xPos = draggedCard.style.getPropertyValue('--base-x') || '0px';
        draggedCard.style.transform = `translate(-50%, -50%) translateX(${xPos})`;
    }

    document.removeEventListener('mousemove', drag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchmove', drag);
    document.removeEventListener('touchend', endDrag);
    draggedCard = null;
}

function placeCard(card, x, y) {
    const el = document.createElement('div');
    el.className = 'placed-card card';
    el.dataset.cardId = card.id;
    
    // Store position as percentage for responsive scaling
    const surfaceRect = readingSurface.getBoundingClientRect();
    const percentX = (x / surfaceRect.width) * 100;
    const percentY = (y / surfaceRect.height) * 100;
    el.style.left = percentX + '%';
    el.style.top = percentY + '%';
    el.dataset.percentX = percentX;
    el.dataset.percentY = percentY;
    
    el.innerHTML = `
        <div class="card-face card-back"></div>
        <div class="card-face card-front">${getCardFrontContent(card)}</div>
        <div class="dev-label">${card.id}</div>
    `;
    
    // Time-based click vs drag detection
    let mouseDownTime = 0;
    let isDragging = false;
    let hasMoved = false;
    let startX, startY, startLeft, startTop;
    const HOLD_THRESHOLD = 150; // ms - anything longer is considered a drag intent
    
    el.addEventListener('mousedown', e => {
        e.preventDefault();
        mouseDownTime = Date.now();
        isDragging = false;
        hasMoved = false;
        startX = e.clientX;
        startY = e.clientY;
        
        // Get current position from bounding rect for accuracy
        const rect = el.getBoundingClientRect();
        const surfaceRect = readingSurface.getBoundingClientRect();
        startLeft = rect.left - surfaceRect.left;
        startTop = rect.top - surfaceRect.top;
        
        el.style.zIndex = 100;
        
        const onMouseMove = (e) => {
            const elapsed = Date.now() - mouseDownTime;
            // Start dragging if held long enough
            if (elapsed >= HOLD_THRESHOLD) {
                isDragging = true;
                hasMoved = true;
                const newLeft = startLeft + e.clientX - startX;
                const newTop = startTop + e.clientY - startY;
                el.style.left = newLeft + 'px';
                el.style.top = newTop + 'px';
            }
        };
        
        const onMouseUp = (e) => {
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
            
            const elapsed = Date.now() - mouseDownTime;
            
            // Check if dropped on deck area to return card
            if (hasMoved) {
                const deckRect = document.querySelector('.deck-area').getBoundingClientRect();
                const dropX = e.clientX;
                const dropY = e.clientY;
                
                if (dropX >= deckRect.left && dropX <= deckRect.right && 
                    dropY >= deckRect.top && dropY <= deckRect.bottom) {
                    returnCardToDeck(card, el);
                    return;
                }
                
                // Convert final position to percentage
                const surfaceRect = readingSurface.getBoundingClientRect();
                const newPercentX = (el.offsetLeft / surfaceRect.width) * 100;
                const newPercentY = (el.offsetTop / surfaceRect.height) * 100;
                el.style.left = newPercentX + '%';
                el.style.top = newPercentY + '%';
                el.dataset.percentX = newPercentX;
                el.dataset.percentY = newPercentY;
            }
            
            // Only trigger click action if it was a quick click (not held for dragging)
            if (elapsed < HOLD_THRESHOLD && !hasMoved) {
                if (!el.classList.contains('flipped')) {
                    // First click: flip the card (with possible reversal)
                    el.classList.add('flipped');
                    if (reversalsEnabled && Math.random() < 0.5) {
                        el.classList.add('reversed');
                    }
                } else {
                    // Second click: show modal
                    showCardModal(card, el.classList.contains('reversed'));
                }
            }
        };
        
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    });
    
    // Touch support
    el.addEventListener('touchstart', e => {
        mouseDownTime = Date.now();
        isDragging = false;
        hasMoved = false;
        const touch = e.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
        
        // Get current position from bounding rect for accuracy
        const rect = el.getBoundingClientRect();
        const surfaceRect = readingSurface.getBoundingClientRect();
        startLeft = rect.left - surfaceRect.left;
        startTop = rect.top - surfaceRect.top;
        
        el.style.zIndex = 100;
        
        const onTouchMove = (e) => {
            const elapsed = Date.now() - mouseDownTime;
            if (elapsed >= HOLD_THRESHOLD) {
                isDragging = true;
                hasMoved = true;
                const touch = e.touches[0];
                const newLeft = startLeft + touch.clientX - startX;
                const newTop = startTop + touch.clientY - startY;
                el.style.left = newLeft + 'px';
                el.style.top = newTop + 'px';
            }
        };
        
        const onTouchEnd = (e) => {
            document.removeEventListener('touchmove', onTouchMove);
            document.removeEventListener('touchend', onTouchEnd);
            
            const elapsed = Date.now() - mouseDownTime;
            
            // Check if dropped on deck area to return card
            if (hasMoved && e.changedTouches && e.changedTouches[0]) {
                const deckRect = document.querySelector('.deck-area').getBoundingClientRect();
                const dropX = e.changedTouches[0].clientX;
                const dropY = e.changedTouches[0].clientY;
                
                if (dropX >= deckRect.left && dropX <= deckRect.right && 
                    dropY >= deckRect.top && dropY <= deckRect.bottom) {
                    returnCardToDeck(card, el);
                    return;
                }
                
                // Convert final position to percentage
                const surfaceRect = readingSurface.getBoundingClientRect();
                const newPercentX = (el.offsetLeft / surfaceRect.width) * 100;
                const newPercentY = (el.offsetTop / surfaceRect.height) * 100;
                el.style.left = newPercentX + '%';
                el.style.top = newPercentY + '%';
                el.dataset.percentX = newPercentX;
                el.dataset.percentY = newPercentY;
            }
            
            if (elapsed < HOLD_THRESHOLD && !hasMoved) {
                if (!el.classList.contains('flipped')) {
                    el.classList.add('flipped');
                    if (reversalsEnabled && Math.random() < 0.5) {
                        el.classList.add('reversed');
                    }
                } else {
                    showCardModal(card, el.classList.contains('reversed'));
                }
            }
        };
        
        document.addEventListener('touchmove', onTouchMove);
        document.addEventListener('touchend', onTouchEnd);
    }, { passive: true });
    
    readingSurface.appendChild(el);
    placedCards.push({ card, element: el });
}

function returnCardToDeck(card, element) {
    // Remove from placed cards
    placedCards = placedCards.filter(p => p.card.id !== card.id);
    element.remove();
    
    // Add back to deck
    deck.push(card);
    
    // Re-render deck to include returned card
    renderDeck();
    updateDevPanel();
}

function makePlacedCardDraggable(el) {
    // No longer needed - drag logic is now in placeCard
}

function showCardModal(card, isReversed = false) {
    const modalCard = document.getElementById('modalCard');
    modalCard.innerHTML = getModalContent(card);
    if (isReversed) {
        modalCard.classList.add('reversed');
    } else {
        modalCard.classList.remove('reversed');
    }
    
    document.getElementById('modalTitle').textContent = card.name + (isReversed ? ' (Reversed)' : '');
    document.getElementById('modalSubtitle').textContent = card.arcana + ' Arcana' + (card.suit ? ' · ' + card.suit : '');
    
    // Populate meanings
    const meanings = TAROT_MEANINGS[card.id];
    if (meanings) {
        document.getElementById('keywordsUpright').textContent = meanings.keywords.upright.join(' · ');
        document.getElementById('keywordsReversed').textContent = meanings.keywords.reversed.join(' · ');
        document.getElementById('meaningText').textContent = isReversed ? meanings.reversed : meanings.upright;
        document.getElementById('modalMeanings').style.display = 'block';
        
        // Highlight active orientation
        document.querySelector('.keywords-upright').classList.toggle('active', !isReversed);
        document.querySelector('.keywords-reversed').classList.toggle('active', isReversed);
    } else {
        document.getElementById('modalMeanings').style.display = 'none';
    }
    
    cardModal.classList.add('active');
}

modalClose.addEventListener('click', () => cardModal.classList.remove('active'));
cardModal.addEventListener('click', e => { if (e.target === cardModal) cardModal.classList.remove('active'); });

// Shuffle with swirl
shuffleBtn.addEventListener('click', () => {
    const cards = deckContainer.querySelectorAll('.card');
    if (cards.length === 0) return;
    shuffleBtn.disabled = true;

    // Phase 1: Scatter
    cards.forEach(card => {
        card.classList.add('shuffling');
        const rx = (Math.random() - 0.5) * 320;
        const ry = (Math.random() - 0.5) * 50;
        const rr = (Math.random() - 0.5) * 400;
        card.style.transform = `translate(-50%, -50%) translateX(${rx}px) translateY(${ry}px) rotate(${rr}deg)`;
        card.style.zIndex = Math.floor(Math.random() * 100);
    });

    // Phase 2: More chaos
    setTimeout(() => {
        cards.forEach(card => {
            const rx = (Math.random() - 0.5) * 280;
            const ry = (Math.random() - 0.5) * 40;
            const rr = (Math.random() - 0.5) * 300;
            card.style.transform = `translate(-50%, -50%) translateX(${rx}px) translateY(${ry}px) rotate(${rr}deg)`;
        });
    }, 300);

    // Phase 3: Shuffle data
    setTimeout(() => { deck = shuffleArray(deck); }, 600);

    // Phase 4: Settle
    setTimeout(() => {
        cards.forEach(card => {
            card.classList.remove('shuffling');
            card.classList.add('settling');
        });
        renderDeckAnimated();
        updateDevPanel();
    }, 800);

    // Cleanup
    setTimeout(() => {
        deckContainer.querySelectorAll('.card').forEach(c => c.classList.remove('settling'));
        shuffleBtn.disabled = false;
    }, 1500);
});

function renderDeckAnimated() {
    const total = deck.length;
    const { cardW, overlap } = getCardDimensions();

    const cardMap = {};
    deckContainer.querySelectorAll('.card').forEach(c => { cardMap[c.dataset.cardId] = c; });

    if (isMobileView() && total > 20) {
        // Two arched rows for mobile - both arch upward
        const half = Math.ceil(total / 2);
        const topRow = deck.slice(0, half);
        const bottomRow = deck.slice(half);
        
        const arcHeight = 20;
        const maxRotation = 15;
        
        const topTotalW = cardW + (topRow.length - 1) * overlap;
        const topStartX = -topTotalW / 2 + cardW / 2;
        
        topRow.forEach((card, i) => {
            const el = cardMap[card.id];
            if (el) {
                const xPos = topStartX + i * overlap;
                const progress = topRow.length > 1 ? i / (topRow.length - 1) : 0.5;
                const arcY = -Math.sin(progress * Math.PI) * arcHeight;
                const rotation = (progress - 0.5) * maxRotation * 2;
                
                el.style.top = '30%';
                el.style.transform = `translate(-50%, -50%) translateX(${xPos}px) translateY(${arcY}px) rotate(${rotation}deg)`;
                el.style.setProperty('--base-x', `${xPos}px`);
                el.style.setProperty('--base-y', `${arcY}px`);
                el.style.setProperty('--base-rot', `${rotation}deg`);
                el.style.zIndex = i;
                el.dataset.index = i;
            }
        });
        
        const bottomTotalW = cardW + (bottomRow.length - 1) * overlap;
        const bottomStartX = -bottomTotalW / 2 + cardW / 2;
        
        bottomRow.forEach((card, i) => {
            const globalIndex = half + i;
            const el = cardMap[card.id];
            if (el) {
                const xPos = bottomStartX + i * overlap;
                const progress = bottomRow.length > 1 ? i / (bottomRow.length - 1) : 0.5;
                const arcY = -Math.sin(progress * Math.PI) * arcHeight;
                const rotation = (progress - 0.5) * maxRotation * 2;
                
                el.style.top = '72%';
                el.style.transform = `translate(-50%, -50%) translateX(${xPos}px) translateY(${arcY}px) rotate(${rotation}deg)`;
                el.style.setProperty('--base-x', `${xPos}px`);
                el.style.setProperty('--base-y', `${arcY}px`);
                el.style.setProperty('--base-rot', `${rotation}deg`);
                el.style.zIndex = globalIndex;
                el.dataset.index = globalIndex;
            }
        });
    } else {
        // Single row (desktop)
        const totalW = cardW + (total - 1) * overlap;
        const startX = -totalW / 2 + cardW / 2;

        deck.forEach((card, i) => {
            const el = cardMap[card.id];
            if (el) {
                const xPos = startX + i * overlap;
                el.style.top = '50%';
                el.style.transform = `translate(-50%, -50%) translateX(${xPos}px)`;
                el.style.setProperty('--base-x', `${xPos}px`);
                el.style.zIndex = i;
                el.dataset.index = i;
            }
        });
    }
}

// Reset
resetBtn.addEventListener('click', () => {
    readingSurface.innerHTML = '';
    placedCards = [];
    initializeDeck();
});

// Reversals toggle
reversalsToggle.addEventListener('click', () => {
    reversalsToggle.classList.toggle('active');
    reversalsEnabled = reversalsToggle.classList.contains('active');
});

// Dev toggle
devToggle.addEventListener('click', () => {
    devToggle.classList.toggle('active');
    document.body.classList.toggle('dev-mode', devToggle.classList.contains('active'));
});

// Theme toggle
themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    const icon = document.getElementById('themeIcon');
    if (document.body.classList.contains('dark')) {
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
    } else {
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
    }
});

// Dev panel
function updateDevPanel() {
    const all = [...deck, ...placedCards.map(p => p.card)];
    const ids = all.map(c => c.id);
    const counts = {};
    ids.forEach(id => { counts[id] = (counts[id] || 0) + 1; });

    devInfo.innerHTML = all.map(c => `<span class="${counts[c.id] > 1 ? 'duplicate' : ''}">${c.id}</span>`).join('');

    const hasDupes = Object.values(counts).some(c => c > 1);
    const unique = new Set(ids).size;

    if (!hasDupes && all.length === 78 && unique === 78) {
        validationStatus.className = 'validation-status valid';
        validationStatus.textContent = `✓ Valid: 78 unique cards (${deck.length} deck, ${placedCards.length} placed)`;
    } else {
        validationStatus.className = 'validation-status invalid';
        validationStatus.textContent = `✗ Invalid: ${unique} unique, ${all.length} total`;
    }
}

// Re-render deck on window resize (debounced)
let resizeTimeout;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        if (deck.length > 0) {
            renderDeck();
        }
    }, 150);
});

// Init
initializeDeck();
</script></body></html>
